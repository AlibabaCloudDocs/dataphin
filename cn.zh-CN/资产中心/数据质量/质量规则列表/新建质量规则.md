---
keyword: [质量规则, 设置告警, 新建分区表达式, 配置质量规则]
---

# 新建质量规则

质量规则是数据质量管理的基础，本文为您介绍如何配置质量规则。

数据表已提交或发布到生产环境中。

## 步骤一 新建质量规则

1.  登录[Dataphin控制台](https://dataphin.console.aliyun.com/workingArea)。

2.  在Dataphin控制台页面，**选择工作区地域**后，单击**进入Dataphin\>\>**。

3.  在Dataphin首页，单击顶部菜单栏中的**资产**。

4.  在数据**资产**页面，单击顶部菜单栏的**质量**。

5.  在数据**质量**页面，单击左侧导航栏的**质量规则**。

6.  在**质量规则**页面，单击**新建质量规则**，进入**新建质量规则**页面。

7.  根据**新建质量规则**对话框提示，选择数据表后单击**开始配置**。

    -   单击![agag](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2867528951/p84128.png)图标后，选择**业务板块**、**所属项目**、**表类型**来筛选表。
    -   在搜索框中输入表名称的关键字快速筛选表。
    ![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1129997951/p84114.png)


## 步骤二 设置告警

如果质量规则校验的结果为异常，则告警中心告警给告警信息的接收人：

1.  单击**告警设置**后的![fagag](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2867528951/p84203.png)图标。

    ![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1129997951/p84202.png)

2.  根据**告警设置**对话框提示，选择**告警接收人**及**告警方式**后，并单击**确定**。

    ![faga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1129997951/p84206.png)


## 步骤三 新建分区表达式

分区表达式用于限定一组质量规则的作用范围。数据表可以有多个分区表达式，每个分区表达式下可以配置多个质量规则，如下图所示。

![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1129997951/p84268.png)

1.  单击**质量规则配置**后的**新建分区表达式**。

2.  根据**新建分区表达式**页面提示，选择**分区表达式类型**并填写分区表达式后，单击**保存**。

    -   如果您选择的是系统提供的分区表达式类型，则系统自动填写分区表达式。

        |分区表达式类型|描述|
        |-------|--|
        |**最近一天**|系统自动填充分区表达式为`ds='${yyyyMMdd}'`。|
        |**本周第一天**|系统自动填充分区表达式为`ds=tdBeginDate('${yyyyMMdd}', 'w', 'yyyyMMdd')`。|
        |**本周最后一天**|系统自动填充分区表达式为`ds=customEndDate('${yyyyMMdd}', 'w', '1', 0, 'yyyyMMdd')`。|
        |**本月第一天**|系统自动填充分区表达式为`ds=tdBeginDate('${yyyyMMdd}', 'm', 'yyyyMMdd')`。|
        |**本月最后一天**|系统自动填充分区表达式为`ds=customEndDate('${yyyyMMdd}', 'm', '01', 0, 'yyyyMMdd')`。|
        |**本季度第一天**|系统自动填充分区表达式为`ds=tdBeginDate('${yyyyMMdd}', 'q', 'yyyyMMdd')`。|
        |**本季度最后一天**|系统自动填充分区表达式为`ds=customEndDate('${yyyyMMdd}', 'q', '0101', 0, 'yyyyMMdd')`。|
        |**本年第一天**|系统自动填充分区表达式为`ds=tdBeginDate('${yyyyMMdd}', 'y', 'yyyyMMdd')`。|
        |**本年最后一天**|系统自动填充分区表达式为`ds=customEndDate('${yyyyMMdd}', 'y', '0101', 0, 'yyyyMMdd')`。|
        |**上月第一天**|系统自动填充分区表达式为`ds=cBeginDate('${yyyyMMdd}', 'm', 'yyyyMMdd')`。|
        |**上月最后一天**|系统自动填充分区表达式为`ds=cEndDate('${yyyyMMdd}', 'm', 'yyyyMMdd')`。|
        |**所有分区**|系统自动填充分区表达式为`ds=ALL`。|

    -   如果您选择的是**自定义**，则需您手动填写分区表达式，例如`ds=${yyyyMM01}`。
    同时您也可以对已添加的分区表达式执行如下操作：

    -   单击**分区表达式**后的![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/1129997951/p84327.png)图标，编辑分区表达式。
    -   单击**分区表达式**后的![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2129997951/p84328.png)图标，删除分区表达式。

## 步骤四 配置质量规则

配置分区表达式下的质量规则：

1.  单击**分区表达式**后的**新建质量规则**。

2.  根据**新建规则**页面提示完成参数配置，并单击**保存**。

    目前数据质量规则配置包括**质量模板规则**和**自定义规则**：

    -   如果您选择的是**质量模板规则**。

        ![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2129997951/p84336.png)

        |参数|描述|
        |--|--|
        |**对象名称**|选择质量规则校验的对象。**对象名称**包括`表：表名称`和`字段：表所包含的字段`。|
        |**规则强度**|选择质量规则的强弱：         -   如果您选择了**强规则**，则质量规则校验的结果为异常时报警并阻塞下游任务节点。
        -   如果您选择了**弱规则**，则质量规则校验的结果为异常时报警但不阻塞下游任务节点。 |
        |**模板类型**|选择质量规则校验的维度。根据质量规则校验对象的类型，系统会自动为您呈现对应校验模板的类型，详情请参见[表 1](#table_8vq_02k_pa6)。|
        |**趋势**|        -   如果校验类型为波动型，则**趋势**包括**绝对值**、**向上**、**向下**。
        -   如果校验类型为对比型，则**趋势**为**固定值**。
详情请参见[表 1](#table_8vq_02k_pa6)。|
        |**对比设置**|选择质量规则校验的结果与目标值的**对比规则**和**目标值**。**对比规则**包括**大于目标值**、**大于等于目标值**、**等于目标值**、**小于目标值**和**小于等于目标值**，且需要设置**对比规则**对应的**目标值**。|
        |**波动阈值**|设定质量规则校验结果的**波动阈值**，波动监测阈值设定在对比值基础上的0~10倍率的范围内。|

        |对象名称|模板类型|趋势|配置项|校验类型|
        |----|----|--|---|----|
        |`表：表名称`|表/分区大小1天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数1天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区大小7天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数7天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数大小7天平均波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数30天对比|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表分区数|固定值|对比设置|对比型|
        |`表：表名称`|表分区数波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`表：表名称`|表/分区行数1，7，30，本月1号分区波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段唯一值个数期望校验|固定值|对比设置|对比型|
        |`字段：表所包含的字段名称`|字段唯一值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段平均值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段最大值1天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段最大值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段最小值1天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段最小值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段汇总值1天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段汇总值1，7，30天波动检测|绝对值、向上、向下|波动阈值|波动型|
        |`字段：表所包含的字段名称`|字段空值个数|固定值|对比设置|对比型|
        |`字段：表所包含的字段名称`|空值率（字段空值个数/行数）|固定值|对比设置|对比型|
        |`字段：表所包含的字段名称`|字段重复个数|固定值|对比设置|对比型|
        |`字段：表所包含的字段名称`|重复率（字段重复个数/总行数）|固定值|对比设置|对比型|

    -   如果您选择的是**自定义规则**。

        ![gaga](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2129997951/p84337.png)

        |参数|描述|
        |--|--|
        |**规则名称**|填写规则名称。|
        |**规则内容**|填写质量规则校验的内容，例如。         ```
select
  sum(value) as metric
from
  current_table ctb
  left outer join related_table rtb on ctb.id = rtb.id
where
  ds = ${bizdate};
        ``` |
        |**规则强度**|选择质量规则的强弱：         -   如果您选择了**强规则**，则质量规则校验的结果为异常时报警并阻塞下游任务节点。
        -   如果您选择了**弱规则**，则质量规则校验的结果为异常时报警但不阻塞下游任务节点。 |
        |**检测类型**|选择质量规则校验的类型。**检测类型**包括**1天波动**、**7天波动**、**7天平均值波动**、**30天平均值波动**、**对比固定值**。|
        |**趋势**|        -   如果校验类型为波动型，则**趋势**包括**绝对值**、**向上**、**向下**。
        -   如果校验类型为对比型，则**趋势**为**固定值**。 |
        |**对比设置**|选择质量规则校验的结果与目标值的**对比规则**和**目标值**。**对比规则**包括**大于目标值**、**大于等于目标值**、**等于目标值**、**小于目标值**和**小于等于目标值**，且需要设置**对比规则**对应的**目标值**。|
        |**波动阈值**|设定质量规则校验结果的**波动阈值**，波动监测阈值设定允许范围为0.0~10.0。|

3.  选择已添加的质量规则，单击下方的**测试试跑**，试跑成功后打开**校验开关**，质量规则即可生效。

    ![afa](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/2129997951/p84426.png)

    试跑状态包括：

    -   **未试跑**
    -   **试跑成功**
    -   **试跑失败**
    -   **试跑中**

