# 新建事实逻辑表

事实逻辑表用于描述业务过程的详细信息。本文为您介绍如何新建事实逻辑表。

-   完成数据域的创建，详情请参见[新建数据域](/cn.zh-CN/数仓规划/业务板块/新建数据域.md)。
-   完成业务过程的创建，详情请参见[新建业务过程](/cn.zh-CN/数据开发/规范建模/规范定义-业务过程/新建业务过程.md)。

新建事实逻辑表的权限限制，详情请参见[数据开发权限列表](/cn.zh-CN/权限管理/数据开发权限列表.md)。

1.  登录[Dataphin控制台](https://dataphin.console.aliyun.com/workingArea)。

2.  在Dataphin控制台页面，选择工作区地域后，单击**进入Dataphin\>\>**。

    您可以通过以下方式，快速进入工作区：

    -   选择工作区地域后，单击**快速开始相关工作**区域中相应的功能模块。
    -   选择工作区地域后，单击**快速进入研发项目**后的**Dev**、**Prod**或**Basic**页签，选择相应的项目。
3.  进入**业务过程**页面。

    1.  在Dataphin首页，单击顶部菜单栏中的**研发**。

    2.  在数据**开发**页面，单击项目名称后的![test](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/3497549951/p110384.png)图标后，单击**Dev**或**Basic**页签，选择数据开发的**Dev**或**Basic**（非**Data\_distill**）项目。

        如果您当前访问的是**Dev**或**Basic**（非**Data\_distill**）项目，且项目为您的数据开发空间，则不需要选择项目。

    3.  在数据**开发**页面，单击**规范建模**。

        如果进入数据**开发**页面后，系统默认进入**规范建模**页签，则无需再次单击**规范建模**页签。

    4.  在**规范建模**页签，单击左侧导航栏![fagag](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/4587549951/p101371.png)**事实逻辑表**图标。

4.  在**事实逻辑表**页面，单击**事实逻辑表**后的![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0887549951/p69320.png)图标。

    您也可以通过以下方式，进入**新建事实逻辑表**配置向导页面：

    -   单击项目名称后的![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0887549951/p69318.png)图标，选择**逻辑表** \> **事实逻辑表**。
    -   在右侧的数据开发总览页面，单击**事实逻辑表**下的![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0887549951/p69322.png)图标。
5.  在**新建事实逻辑表**配置向导页面，完成以下操作。

    1.  在**基本信息**对话框，配置参数。

        |参数|描述|
        |--|--|
        |**数据域**|选择业务过程所属的**数据域**。|
        |**业务过程**|选择业务过程。|
        |**明细类型**|系统支持明细类型选择**事务型**和**周期快照型**：         -   **事务型**用于跟踪和度量业务发生过程中的事件。例如，设计订单业务发生过程中的支付订单事件。
        -   **周期快照型**用于周期性度量实体的状态。例如，账户余额和商品库存等。 |
        |**英文名**|**英文名**由字母、数字或下划线（\_）组合组成。英文名的后缀说明如下：         -   **df**：数据时效为天，明细类型为周期快照型。
        -   **di**：数据时效为天，明细类型为事务型。
        -   **hf**：数据时效为小时，明细类型为周期快照型。
        -   **thi**：数据时效为小时，明细类型为事务型。
        -   **mf**：数据时效为分钟，明细类型为周期快照型。
        -   **tmi**：数据时效为分钟，明细类型为事务型。
**说明：** **英文名**不能超过64个字符。 |
        |**名称**|**名称**由汉字、字母、数字、下划线（\_）或短划线（-）组合组成。**说明：** **名称**不能超过64个字符。 |
        |**描述**|输入对事实逻辑表的简单描述。|
        |**来源主表**|选择事实逻辑表的**来源主表**。您可以选择物理表或逻辑表作为来源主表。|

    2.  单击**下一步**。

    3.  在**主键定义**对话框中，配置参数。

        ![fagaga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5487549951/p101377.png)

        -   如果**是否设定主键**选择为**否**，则可以配置筛选条件，也可以不配置筛选条件。
        -   如果**是否设定主键**选择为**是**，则配置如下参数。

            |参数|描述|
            |--|--|
            |**字段英文名**|输入主键字段的英文名称。例如item\_id。|
            |**字段名称**|输入主键字段的名称。例如商品\_id。|
            |**字段数据类型**|选择主键字段的数据类型。|
            |**字段计算逻辑**|执行以下操作，输入主键的计算逻辑：            1.  编写SQL代码。

您可以单击**参考示例**，查看示例代码。

            2.  单击**规范性校验**，校验代码的语法及权限。

如果规范性校验失败，您可以单击**格式化**，系统自动调整代码语法。 |

            **说明：** 如果事实逻辑表有唯一的主键（例如订单ID），则添加的字段需要关联至该事实逻辑表的主键。

    4.  单击**提交**。

6.  添加度量。

    1.  在事实逻辑表的主表页面，单击**添加度量**。

        您也可以执行以下操作，进入**新建度量**对话框：

        1.  在事实逻辑表的主表页面，单击**主表编辑**。
        2.  鼠标悬停至**新建字段**后，单击**度量**。
        3.  在**新建度量**页面，配置参数。

            ![test](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5487549951/p132643.png)

            -   如果**来源表**选中**引入字段**，则执行以下操作，添加属性：

                1.  选择新增字段。

                    您也可以在搜索框中，输入字段名称的关键字，快速搜索字段。

                2.  单击字段后![tewtw](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5487549951/p132636.png)图标。
                3.  在**新建字段**区域，填写字段的**字段英文名**和**字段名称**。

                    |参数|描述|
                    |--|--|
                    |**字段英文名**|**字段英文名**由字母、数字或下划线（\_）组合组成。**说明：** **字段英文名**不能超过64个字符。 |
                    |**字段名称**|**字段名称**由汉字、字母、数字、下划线（\_）或短划线（-）组合组成。**说明：** **字段名称**不能超过64个字符。 |

                对已添加的字段，您可以单击**操作**列下的![tata](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5487549951/p132638.png)图标、![twaga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5487549951/p132639.png)图标或![taga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p132640.png)图标，查看字段的计算逻辑、编辑字段或删除字段。

            -   单击**保存并校验**。
            -   如果**来源表**选中**SQL自定义字段**，则执行以下操作，添加属性：
                1.  在代码的编写区域，编写SQL代码。

                    您可以单击**参考示例**，查看SQL代码示例。

                2.  单击**规范性校验**，校验SQL代码的语法及权限。

                    如果规范性校验失败，您可以单击**格式化**，系统会自动调整代码格式。

                3.  单击**保存并校验**。
7.  添加关联维度。

    **说明：** 添加关联维度的限制：

    -   如果事实逻辑表的数据时效为天，则系统仅支持添加数据时效为天的维度。
    -   如果事实逻辑表的数据时效为小时，则系统支持添加数据时效为天或小时的维度。
    -   如果事实逻辑表的数据时效为分钟，则系统支持添加数据时效为天、小时或分钟的维度。
    1.  在事实逻辑表的主表页面，您可以通过以下方式，进入**新建关联维度**对话框。

        -   单击**主表**下的**添加关联维度**前的![ffag](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p101400.png)图标。
        -   单击页面上方的**主表编辑**。在主表编辑页面，鼠标悬停至**新建字段**后，选择**关联维度**。

            ![fFf](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p101406.png)

    2.  在**新建关联维度**对话框，配置参数。

        ![FAGAG](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p101407.png)

        |参数|描述|
        |--|--|
        |**关联维度信息**|选择需要关联的维度。|
        |**编辑关联逻辑**|选择已添加的度量。|
        |**编辑维度角色**|**编辑维度角色**包括**角色英文名**和**角色名称**：         -   **角色英文名**默认为维度的英文名。
        -   **角色名称**默认为维度的名称。
您可以根据业务需求，修改**角色英文名**和**角色名称**。|
        |**默认值设定**|如果事实逻辑表的外键字段和维度表关联不上，则系统将**默认值设定**为-110。|

8.  添加事实属性。

    1.  在事实逻辑表的主表页面，您可以通过以下任何一种方式，进入**新建事实属性**对话框。

        -   单击**主表**下的**添加事实属性**前的![ffag](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p101400.png)图标。
        -   单击页面上方的**主表编辑**。在主表编辑页面，鼠标悬停至**新建字段**后，单击**事实属性**。
    2.  在**新建事实属性**对话框中，配置参数。

        ![fagaga](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p101432.png)

        -   如果**来源表**选择为**引入字段**，则单击**选择新增字段**区域字段后的![afgag](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6487549951/p101417.png)图标，将字段增加到**新增字段**区域，并填写**字段名称**。单击**保存并校验**，完成事实属性的添加。
        -   如果**来源表**选择为**SQL自定义字段**，则单击**参考示例**，参考示例填写SQL语句定义事实属性字段。单击**规范性校验**，校验SQL语句的语法。校验通过后，单击**保存并校验**，完成事实属性的添加。
9.  提交和发布事实逻辑表。

    1.  完成参数配置后，单击**提交**。

    2.  在**提交备注**页面，填写备注信息。

    3.  单击**确定并提交**，完成事实逻辑表的提交。

    4.  发布事实逻辑表。

        -   如果您的开发模式是Dev-Prod模式，则需要发布事实逻辑表，详情请参见[t136654.md\#](/cn.zh-CN/任务发布/管理发布任务.md)。
        -   如果您的开发模式是Basic模式，则无需发布事实逻辑表。

